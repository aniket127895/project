<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud-Powered Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --dark: #1e293b;
            --light: #f8fafc;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            transition: all 0.3s ease;
        }

        .task-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .priority-high { border-left: 4px solid var(--danger); }
        .priority-medium { border-left: 4px solid var(--secondary); }
        .priority-low { border-left: 4px solid var(--success); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header Section -->
        <header class="bg-white rounded-lg shadow-md p-6 mb-8 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/aee37486-760d-43e0-8720-6c4abe25af5b.png" alt="Cloud task manager logo with cloud outline and checkmark symbol in blue gradient" class="w-12 h-12 mr-4 rounded-lg shadow-sm" />
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Cloud-Powered Task Manager</h1>
                    <p class="text-gray-600">Your tasks, synced across all devices</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/bd72af86-381c-437f-8d41-c4b32f0c92a3.png" alt="User profile picture, showing a generic avatar with blue background" class="w-10 h-10 rounded-full border-2 border-indigo-200" />
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
                </div>
                <span class="hidden md:block font-medium text-gray-700">User Account</span>
            </div>
        </header>

        <!-- Dashboard Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center">
                <div class="bg-indigo-100 p-3 rounded-lg mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Total Tasks</p>
                    <h3 class="text-xl font-bold text-grayN-800"><span id="total-tasks">0</span></h3>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center">
                <div class="bg-green-100 p-3 rounded-lg mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Completed</p>
                    <h3 class="text-xl font-bold text-gray-800"><span id="completed-tasks">0</span></h3>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center">
                <div class="bg-orange-100 p-3 rounded-lg mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Pending</p>
                    <h3 class="text-xl font-bold text-gray-800"><span id="pending-tasks">0</span></h3>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center">
                <div class="bg-red-100 p-3 rounded-lg mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Overdue</p>
                    <h3 class="text-xl font-bold text-gray-800"><span id="overdue-tasks">0</span></h3>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Task List Section -->
            <div class="flex-1">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">My Tasks</h2>
                        <button id="add-task-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            Add Task
                        </button>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="filter-btn active px-4 py-2 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800" data-filter="all">All</button>
                        <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-800" data-filter="todo">To Do</button>
                        <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-blue-100 text-blue-800" data-filter="in-progress">In Progress</button>
                        <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-800" data-filter="completed">Completed</button>
                    </div>

                    <div id="tasks-container" class="space-y-4">
                        <!-- Sample Task (will be populated by JavaScript) -->
                        <div class="task-card bg-white p-4 rounded-lg border border-gray-200 fade-in priority-medium" data-id="sample" data-status="todo" data-priority="medium">
                            <div class="flex justify-between items-start">
                                <div class="flex items-start">
                                    <input type="checkbox" class="mt-1 h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
                                    <div class="ml-3">
                                        <h3 class="font-medium text-gray-900 line-through">Sample Task</h3>
                                        <p class="text-sm text-gray-500 mt-1">This is a sample task description that will be replaced with real data</p>
                                        <div class="flex flex-wrap gap-2 mt-2">
                                            <span class="px-2 py-1 text-xs rounded-full bg-indigo-100 text-indigo-800">Work</span>
                                            <span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">Medium</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="edit-btn text-gray-400 hover:text-indigo-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </button>
                                    <button class="delete-btn text-gray-400 hover:text-red-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- End Sample Task -->
                    </div>
                </div>
            </div>

            <!-- Task Details and Form Section -->
            <div class="md:w-80">
                <div id="task-details" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Task Details</h3>
                    <div class="space-y-4">
                        <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/a4f90fca-8e27-4504-91cd-8512d3650c42.png" alt="Task visualization showing progress charts and related imagery" class="w-full rounded-lg" />
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Task Name</label>
                            <p id="detail-title" class="mt-1 text-gray-900 font-medium">Loading...</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Description</label>
                            <p id="detail-description" class="mt-1 text-gray-600">Loading...</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Due Date</label>
                            <p id="detail-due-date" class="mt-1 text-gray-600">Loading...</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Priority</label>
                            <p id="detail-priority" class="mt-1 text-gray-600">Loading...</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Category</label>
                            <p id="detail-category" class="mt-1 text-gray-600">Loading...</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Status</label>
                            <p id="detail-status" class="mt-1 text-gray-600">Loading...</p>
                        </div>
                        <div class="flex space-x-2 pt-2">
                            <button id="edit-details-btn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition">
                                Edit
                            </button>
                            <button id="delete-details-btn" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Task Form (Hidden by default) -->
                <div id="task-form" class="bg-white rounded-lg shadow-md p-6 hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4" id="form-title">Add New Task</h3>
                    <form id="task-input-form">
                        <input type="hidden" id="task-id">
                        <div class="mb-4">
                            <label for="task-title" class="block text-sm font-medium text-gray-700 mb-1">Task Title *</label>
                            <input type="text" id="task-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="task-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="task-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="task-due-date" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                            <input type="datetime-local" id="task-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="priority" value="high" class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300">
                                    <span class="ml-2 text-gray-700">High</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="priority" value="medium" checked class="h-4 w-4 text-orange-500 focus:ring-orange-500 border-gray-300">
                                    <span class="ml-2 text-gray-700">Medium</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="priority" value="low" class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300">
                                    <span class="ml-2 text-gray-700">Low</span>
                                </label>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="task-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="task-category" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                                <option value="study">Study</option>
                                <option value="health">Health</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="task-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="task-status" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="todo">To Do</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="flex space-x-2">
                            <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition">
                                Save
                            </button>
                            <button type="button" id="cancel-form-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Cloud Sync Status -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                        </svg>
                        <h3 class="text-lg font-bold text-gray-800">Cloud Sync</h3>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Last Sync:</span>
                            <span class="font-medium" id="last-sync">Just now</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Storage Used:</span>
                            <span class="font-medium" id="storage-used">1.2 MB of 10 MB</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="storage-progress" class="bg-indigo-600 h-2 rounded-full" style="width: 12%"></div>
                        </div>
                    </div>
                    <button id="sync-now-btn" class="w-full mt-4 bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-4 py-2 rounded-lg text-sm font-medium transition">
                        Sync Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Initialize NoSQL database (simulating NoSQL with IndexedDB)
        class TaskDatabase {
            constructor() {
                this.dbName = 'TaskManagerDB';
                this.dbVersion = 1;
                this.db = null;
                this.initDB();
            }

            initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('tasks')) {
                            const store = db.createObjectStore('tasks', { keyPath: 'id' });
                            store.createIndex('status', 'status', { unique: false });
                            store.createIndex('category', 'category', { unique: false });
                            store.createIndex('priority', 'priority', { unique: false });
                        }
                    };
                    
                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        this.updateStats();
                        resolve(this.db);
                    };
                    
                    request.onerror = (event) => {
                        console.error('Database error:', event.target.error);
                        reject(event.target.error);
                    };
                });
            }

            getAllTasks() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readonly');
                    const store = transaction.objectStore('tasks');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            getTask(id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readonly');
                    const store = transaction.objectStore('tasks');
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            addTask(task) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    const request = store.add(task);
                    
                    request.onsuccess = () => {
                        this.updateLastSync();
                        this.updateStats();
                        resolve();
                    };
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            updateTask(task) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    const request = store.put(task);
                    
                    request.onsuccess = () => {
                        this.updateLastSync();
                        this.updateStats();
                        resolve();
                    };
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            deleteTask(id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    const request = store.delete(id);
                    
                    request.onsuccess = () => {
                        this.updateLastSync();
                        this.updateStats();
                        resolve();
                    };
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async updateStats() {
                const tasks = await this.getAllTasks();
                
                // Update dashboard counters
                document.getElementById('total-tasks').textContent = tasks.length;
                document.getElementById('completed-tasks').textContent = tasks.filter(t => t.status === 'completed').length;
                document.getElementById('pending-tasks').textContent = tasks.filter(t => t.status !== 'completed').length;
                
                // Update storage visualization (simulated)
                const storageUsed = tasks.length * 2.5; // Simulate ~2.5KB per task
                document.getElementById('storage-used').textContent = ⁠ ${(storageUsed / 1024).toFixed(1)} MB of 10 MB ⁠;
                document.getElementById('storage-progress').style.width = ⁠ ${Math.min(100, (storageUsed / 1024) * 10)}% ⁠;
            }

            updateLastSync() {
                const now = new Date();
                const options = { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit', 
                    hour12: true 
                };
                document.getElementById('last-sync').textContent = ⁠ Today at ${now.toLocaleTimeString('en-US', options)} ⁠;
            }
        }

        // UI Controller
        class TaskUIController {
            constructor(db) {
                this.db = db;
                this.currentTaskId = null;
                this.initElements();
                this.bindEvents();
                this.loadTasks();
            }

            initElements() {
                this.elements = {
                    tasksContainer: document.getElementById('tasks-container'),
                    taskForm: document.getElementById('task-form'),
                    taskDetails: document.getElementById('task-details'),
                    addTaskBtn: document.getElementById('add-task-btn'),
                    cancelFormBtn: document.getElementById('cancel-form-btn'),
                    editDetailsBtn: document.getElementById('edit-details-btn'),
                    deleteDetailsBtn: document.getElementById('delete-details-btn'),
                    formTitle: document.getElementById('form-title'),
                    taskInputForm: document.getElementById('task-input-form'),
                    taskId: document.getElementById('task-id'),
                    taskTitle: document.getElementById('task-title'),
                    taskDescription: document.getElementById('task-description'),
                    taskDueDate: document.getElementById('task-due-date'),
                    detailTitle: document.getElementById('detail-title'),
                    detailDescription: document.getElementById('detail-description'),
                    detailDueDate: document.getElementById('detail-due-date'),
                    detailPriority: document.getElementById('detail-priority'),
                    detailCategory: document.getElementById('detail-category'),
                    detailStatus: document.getElementById('detail-status'),
                    syncNowBtn: document.getElementById('sync-now-btn')
                };
            }

            bindEvents() {
                // Button events
                this.elements.addTaskBtn.addEventListener('click', () => this.showForm());
                this.elements.cancelFormBtn.addEventListener('click', () => this.hideForm());
                this.elements.editDetailsBtn.addEventListener('click', () => this.editCurrentTask());
                this.elements.deleteDetailsBtn.addEventListener('click', () => this.deleteCurrentTask());
                this.elements.syncNowBtn.addEventListener('click', () => this.syncNow());
                
                // Form submission
                this.elements.taskInputForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveTask();
                });
                
                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.loadTasks(e.target.dataset.filter);
                    });
                });
            }

            async loadTasks(filter = 'all') {
                const tasks = await this.db.getAllTasks();
                this.elements.tasksContainer.innerHTML = '';
                
                let filteredTasks = tasks;
                if (filter !== 'all') {
                    filteredTasks = tasks.filter(task => task.status === filter);
                }
                
                if (filteredTasks.length === 0) {
                    this.elements.tasksContainer.innerHTML = `
                        <div class="text-center py-8">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">No tasks found</h3>
                            <p class="mt-1 text-sm text-gray-500">${filter === 'all' ? 'Get started by adding a new task.' : ⁠ No ${filter.replace('-', ' ')} tasks found. ⁠}</p>
                        </div>
                    `;
                    return;
                }
                
                filteredTasks.forEach(task => {
                    const taskEl = this.createTaskElement(task);
                    this.elements.tasksContainer.appendChild(taskEl);
                });
            }

            createTaskElement(task) {
                const taskEl = document.createElement('div');
                taskEl.className = ⁠ task-card bg-white p-4 rounded-lg border border-gray-200 fade-in priority-${task.priority} ⁠;
                taskEl.dataset.id = task.id;
                taskEl.dataset.status = task.status;
                taskEl.dataset.priority = task.priority;
                
                const priorityClasses = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-orange-100 text-orange-800',
                    low: 'bg-green-100 text-green-800'
                };
                
                const statusClasses = {
                    todo: 'bg-gray-100 text-gray-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    completed: 'bg-green-100 text-green-800'
                };
                
                const dueDate = task.dueDate ? new Date(task.dueDate).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                }) : 'No due date';
                
                // Determine if the task is completed for checkbox and text styling
                const isCompleted = task.status === 'completed';
                
                taskEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex items-start">
                            <input type="checkbox" ${isCompleted ? 'checked' : ''} class="mt-1 h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
                            <div class="ml-3">
                                <h3 class="font-medium text-gray-900 ${isCompleted ? 'line-through' : ''}">${task.title}</h3>
                                <p class="text-sm text-gray-500 mt-1">${task.description || 'No description'}</p>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="px-2 py-1 text-xs rounded-full capitalize bg-indigo-100 text-indigo-800">${task.category}</span>
                                    <span class="px-2 py-1 text-xs rounded-full capitalize ${priorityClasses[task.priority]}">${task.priority}</span>
                                    <span class="px-2 py-1 text-xs rounded-full ${statusClasses[task.status] || 'bg-gray-100 text-gray-800'}">${task.status.replace('-', ' ')}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-btn text-gray-400 hover:text-indigo-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </button>
                            <button class="delete-btn text-gray-400 hover:text-red-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners to the buttons we just created
                taskEl.querySelector('.edit-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.showDetails(task.id);
                });
                
                taskEl.querySelector('.delete-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.deleteTask(task.id);
                });
                
                taskEl.querySelector('input[type="checkbox"]').addEventListener('change', (e) => {
                    const newStatus = e.target.checked ? 'completed' : 'todo';
                    this.updateTaskStatus(task.id, newStatus);
                });
                
                taskEl.addEventListener('click', () => {
                    this.showDetails(task.id);
                });
                
                return taskEl;
            }

            showForm(taskId = null) {
                this.elements.taskDetails.classList.add('hidden');
                
                if (taskId) {
                    this.elements.formTitle.textContent = 'Edit Task';
                    this.loadTaskIntoForm(taskId);
                } else {
                    this.elements.formTitle.textContent = 'Add New Task';
                    this.resetForm();
                }
                
                this.elements.taskForm.classList.remove('hidden');
            }

            hideForm() {
                this.elements.taskForm.classList.add('hidden');
                this.currentTaskId = null;
                
                // Show details again if we're editing an existing task
                if (this.currentTaskId) {
                    this.showDetails(this.currentTaskId);
                }
            }

            async loadTaskIntoForm(taskId) {
                try {
                    const task = await this.db.getTask(taskId);
                    if (task) {
                        this.currentTaskId = taskId;
                        this.elements.taskId.value = taskId;
                        this.elements.taskTitle.value = task.title;
                        this.elements.taskDescription.value = task.description || '';
                        
                        if (task.dueDate) {
                            const dueDate = new Date(task.dueDate);
                            // Format for datetime-local input
                            const formattedDate = dueDate.toISOString().slice(0, 16);
                            this.elements.taskDueDate.value = formattedDate;
                        } else {
                            this.elements.taskDueDate.value = '';
                        }
                        
                        // Set priority radio button
                        document.querySelector(⁠ input[name="priority"][value="${task.priority}"] ⁠).checked = true;
                        
                        // Set category and status
                        this.elements.taskCategory.value = task.category;
                        this.elements.taskStatus.value = task.status;
                    }
                } catch (error) {
                    console.error('Error loading task:', error);
                    alert('Failed to load task details. Please try again.');
                }
            }

            resetForm() {
                this.elements.taskInputForm.reset();
                this.elements.taskId.value = '';
                this.elements.taskCategory.value = 'work';
                this.elements.taskStatus.value = 'todo';
                document.querySelector('input[name="priority"][value="medium"]').checked = true;
            }

            getFormData() {
                return {
                    id: this.elements.taskId.value || crypto.randomUUID(),
                    title: this.elements.taskTitle.value.trim(),
                    description: this.elements.taskDescription.value.trim(),
                    dueDate: this.elements.taskDueDate.value ? new Date(this.elements.taskDueDate.value).toISOString() : null,
                    priority: document.querySelector('input[name="priority"]:checked').value,
                    category: this.elements.taskCategory.value,
                    status: this.elements.taskStatus.value,
                    createdAt: this.elements.taskId.value ? undefined : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
            }

            validateTask(task) {
                if (!task.title) {
                    alert('Task title is required');
                    return false;
                }
                return true;
            }

            async saveTask() {
                const task = this.getFormData();
                
                if (!this.validateTask(task)) {
                    return;
                }
                
                try {
                    if (this.currentTaskId) {
                        await this.db.updateTask(task);
                    } else {
                        await this.db.addTask(task);
                    }
                    
                    this.hideForm();
                    this.loadTasks(document.querySelector('.filter-btn.active').dataset.filter);
                } catch (error) {
                    console.error('Error saving task:', error);
                    alert('Failed to save task. Please try again.');
                }
            }

            async showDetails(taskId) {
                try {
                    const task = await this.db.getTask(taskId);
                    if (task) {
                        this.currentTaskId = taskId;
                        
                        this.elements.detailTitle.textContent = task.title;
                        this.elements.detailDescription.textContent = task.description || 'No description provided';
                        
                        if (task.dueDate) {
                            const dueDate = new Date(task.dueDate);
                            this.elements.detailDueDate.textContent = dueDate.toLocaleDateString('en-US', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        } else {
                            this.elements.detailDueDate.textContent = 'No due date';
                        }
                        
                        this.elements.detailPriority.textContent = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
                        this.elements.detailCategory.textContent = task.category.charAt(0).toUpperCase() + task.category.slice(1);
                        this.elements.detailStatus.textContent = task.status === 'in-progress' ? 'In Progress' : task.status.charAt(0).toUpperCase() + task.status.slice(1);
                        
                        this.elements.taskForm.classList.add('hidden');
                        this.elements.taskDetails.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error loading task details:', error);
                    alert('Failed to load task details. Please try again.');
                }
            }

            async editCurrentTask() {
                if (this.currentTaskId) {
                    this.showForm(this.currentTaskId);
                }
            }

            async deleteCurrentTask() {
                if (this.currentTaskId && confirm('Are you sure you want to delete this task?')) {
                    try {
                        await this.db.deleteTask(this.currentTaskId);
                        this.elements.taskDetails.classList.add('hidden');
                        this.currentTaskId = null;
                        this.loadTasks(document.querySelector('.filter-btn.active').dataset.filter);
                    } catch (error) {
                        console.error('Error deleting task:', error);
                        alert('Failed to delete task. Please try again.');
                    }
                }
            }

            async deleteTask(taskId) {
                if (confirm('Are you sure you want to delete this task?')) {
                    try {
                        await this.db.deleteTask(taskId);
                        this.loadTasks(document.querySelector('.filter-btn.active').dataset.filter);
                        
                        // If we're viewing the task being deleted, hide the details panel
                        if (this.currentTaskId === taskId) {
                            this.elements.taskDetails.classList.add('hidden');
                            this.currentTaskId = null;
                        }
                    } catch (error) {
                        console.error('Error deleting task:', error);
                        alert('Failed to delete task. Please try again.');
                    }
                }
            }

            async updateTaskStatus(taskId, newStatus) {
                try {
                    const task = await this.db.getTask(taskId);
                    if (task) {
                        task.status = newStatus;
                        task.updatedAt = new Date().toISOString();
                        await this.db.updateTask(task);
                        
                        // If we're viewing this task, update the details panel
                        if (this.currentTaskId === taskId) {
                            this.showDetails(taskId);
                        }
                    }
                } catch (error) {
                    console.error('Error updating task status:', error);
                    // Revert checkbox state
                    const taskEl = document.querySelector(⁠ .task-card[data-id="${taskId}"] ⁠);
                    if (taskEl) {
                        const checkbox = taskEl.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }
                }
            }

            async syncNow() {
                try {
                    // Simulate cloud sync with random delay
                    this.elements.syncNowBtn.disabled = true;
                    this.elements.syncNowBtn.textContent = 'Syncing...';
                    
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    this.db.updateLastSync();
                    this.elements.syncNowBtn.textContent = 'Sync Complete!';
                    
                    setTimeout(() => {
                        this.elements.syncNowBtn.textContent = 'Sync Now';
                        this.elements.syncNowBtn.disabled = false;
                    }, 2000);
                } catch (error) {
                    console.error('Sync error:', error);
                    this.elements.syncNowBtn.textContent = 'Sync Failed';
                    this.elements.syncNowBtn.disabled = false;
                }
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const db = new TaskDatabase();
                await db.initDB();
                const ui = new TaskUIController(db);
                
                // Add some sample tasks if database is empty (for demo purposes)
                const tasks = await db.getAllTasks();
                if (tasks.length === 0) {
                    await db.addTask({
                        id: crypto.randomUUID(),
                        title: 'Welcome to your task manager',
                        description: 'Start by adding your first task using the + button',
                        dueDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                        priority: 'medium',
                        category: 'work',
                        status: 'todo',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    
                    await db.addTask({
                        id: crypto.randomUUID(),
                        title: 'Check out the priority system',
                        description: 'Tasks can have high, medium, or low priority',
                        dueDate: null,
                        priority: 'high',
                        category: 'personal',
                        status: 'in-progress',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    
                    ui.loadTasks();
                }
            } catch (error) {
                console.error('Application initialization failed:', error);
                alert('Failed to initialize the application. Please try refreshing the page.');
            }
        });
    </script>
</body>
</html>